<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Helper | Troubleshooting Guide</title>
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .font-serif { font-family: 'DM Serif Display', serif; }
        .font-sans { font-family: 'Inter', sans-serif; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .bg-psc { background-color: #206a5d; }
        .text-psc { color: #206a5d; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [step, setStep] = useState('start');
            const [history, setHistory] = useState([]);
            const [lang, setLang] = useState('en');
            const [userInput, setUserInput] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [errorMessage, setErrorMessage] = useState(null);

            const apiKey = ""; 

            const content = {
                en: {
                    header: "Pi Helper",
                    subHeader: "Troubleshooting Guide",
                    startOver: "Reset",
                    mission: "Instruction:",
                    recommendation: "Diagnosis & Next Steps:",
                    footer: "Built for MakerLab in Schools by Penang Science Cluster â€¢ Inspiring Innovation",
                    aiLabel: "Optional / Pilihan",
                    aiSubLabel: "Optional: Tell us what's happening",
                    aiPlaceholder: "e.g., 'The light is yellow' or 'The screen is black'...",
                    aiButton: "Analyze Issue",
                    aiInfo: "AI will jump to the best step",
                    aiError: "System couldn't identify the step. Please use the manual guide below.",
                    steps: {
                        start: {
                            title: "Is your Raspberry Pi switching on?",
                            description: "Let's check if the hardware is getting any power at all.",
                            icon: 'power',
                            options: [
                                { label: "Yes, it's on!", next: 'led_check', color: 'bg-[#206a5d]' },
                                { label: "No, it's silent.", next: 'plug_in', color: 'bg-slate-700' }
                            ]
                        },
                        plug_in: {
                            title: "Checking the Power Outlet",
                            description: "Simple things first! Let's make sure the power is connected.",
                            icon: 'zap',
                            instruction: "Ensure the power cable is firmly plugged into both the Raspberry Pi hardware and the power extension/wall outlet.",
                            image: "https://images.unsplash.com/photo-1591488320449-011701bb6704?auto=format&fit=crop&q=80&w=1000", 
                            options: [
                                { label: "Okay, it's plugged in!", next: 'led_check', color: 'bg-[#206a5d]' }
                            ]
                        },
                        led_check: {
                            title: "The Power Light Test",
                            description: "Look at the Raspberry Pi hardware. There is a light on the power button itself.",
                            icon: 'palette',
                            instruction: "What color is the light on the Raspberry Pi power button?",
                            image: "https://www.raspberrypi.com/documentation/computers/images/Pi5-annotated-top.png",
                            options: [
                                { label: "Yellow (Blinking/Steady)", next: 'use_check', color: 'bg-yellow-600' },
                                { label: "No light at all.", next: 'swap_psu', color: 'bg-slate-600' }
                            ]
                        },
                        swap_psu: {
                            title: "Power Supply Swap",
                            description: "Since there is no light, the current power supply or cable might be faulty.",
                            icon: 'refresh-cw',
                            instruction: "Try swapping the Raspberry Pi power supply/cable with another one that you know works.",
                            options: [
                                { label: "I see a light now!", next: 'use_check_swapped', color: 'bg-[#206a5d]' },
                                { label: "Still no light at all.", next: 'pi_faulty_result', color: 'bg-red-600' }
                            ]
                        },
                        pi_faulty_result: {
                            type: 'result',
                            status: 'error',
                            title: "Diagnosis: Hardware Failure",
                            description: "Despite troubleshooting the power source and connections, the Raspberry Pi board refuses to start up correctly.",
                            recommendation: "The Raspberry Pi hardware board itself is faulty. Please label this unit as 'Faulty' and contact your PSC program lead for a replacement.",
                            icon: 'alert-circle'
                        },
                        use_check: {
                            title: "Usability Check",
                            description: "The light is yellow, which is a great sign for the hardware!",
                            icon: 'cpu',
                            instruction: "Are you able to use the computer (see the desktop, move the mouse)?",
                            options: [
                                { label: "Yes, I can use it!", next: 'os_confirmation', color: 'bg-[#206a5d]' },
                                { label: "No, I still can't use it.", next: 'monitor_check', color: 'bg-slate-700' }
                            ]
                        },
                        use_check_swapped: {
                            title: "Usability Check",
                            description: "The hardware is responding to the new power source.",
                            icon: 'cpu',
                            instruction: "Are you able to use the computer now (see the desktop, move the mouse)?",
                            options: [
                                { label: "Yes, it works now!", next: 'os_confirmation_swapped', color: 'bg-[#206a5d]' },
                                { label: "No, I'm still not seeing anything.", next: 'monitor_check', color: 'bg-slate-700' }
                            ]
                        },
                        os_confirmation: {
                            title: "System Verification",
                            description: "You've confirmed the hardware and input are responding.",
                            icon: 'layout',
                            instruction: "Can you see the full Raspberry Pi OS desktop (the menu, wallpaper, and icons)?",
                            options: [
                                { label: "Yes, everything is working!", next: 'it_works', color: 'bg-[#206a5d]' },
                                { label: "No, I'm not seeing the full OS.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_swapped: {
                            title: "Final Verification",
                            description: "The hardware is responding to the new power source.",
                            icon: 'layout',
                            instruction: "Is the Raspberry Pi OS desktop fully visible and working?",
                            options: [
                                { label: "Yes, it's perfect!", next: 'faulty_cable_result', color: 'bg-[#206a5d]' },
                                { label: "No, I'm not seeing the full OS.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_hdmi: {
                            title: "Visual Verification",
                            description: "Checking if the monitor connection is now stable.",
                            icon: 'layout',
                            instruction: "Is the Raspberry Pi OS desktop fully visible and working on the screen now?",
                            options: [
                                { label: "Yes, I see the OS desktop!", next: 'faulty_hdmi_result', color: 'bg-[#206a5d]' },
                                { label: "No, I'm not seeing the full OS.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_monitor: {
                            title: "Visual Verification",
                            description: "The Raspberry Pi is displaying on the new monitor.",
                            icon: 'layout',
                            instruction: "Is the Raspberry Pi OS desktop fully visible and working on the new screen?",
                            options: [
                                { label: "Yes, it works!", next: 'faulty_monitor_result', color: 'bg-[#206a5d]' },
                                { label: "No, software issue.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        monitor_check: {
                            title: "Is the Screen Showing Anything?",
                            description: "The hardware is on, but we need to check if the image is reaching the screen.",
                            icon: 'monitor',
                            instruction: "Look at your monitor screen. Do you see any text, colors, or the desktop?",
                            options: [
                                { label: "Yes, I see something (but it's not working right)", next: 'sd_reformat', color: 'bg-orange-500' },
                                { label: "No, it's completely black.", next: 'monitor_hdmi_check', color: 'bg-slate-700' }
                            ]
                        },
                        monitor_hdmi_check: {
                            title: "Monitor Rescue: HDMI Check",
                            description: "Let's check the connection between the Pi and the screen.",
                            icon: 'settings',
                            instruction: "Follow these steps to check the monitor hardware connection:",
                            detailedSteps: [
                                { text: "Make sure the monitor is switched on." },
                                { text: "Unplug and replug the HDMI cable firmly." },
                                { text: "Try a different HDMI cable if available." }
                            ],
                            image: "https://images.unsplash.com/photo-1629739682536-3990664972f7?auto=format&fit=crop&q=80&w=1000",
                            options: [
                                { label: "It works now!", next: 'os_confirmation_hdmi', color: 'bg-[#206a5d]' },
                                { label: "Still a black screen.", next: 'monitor_swap_check', color: 'bg-slate-700' }
                            ]
                        },
                        monitor_swap_check: {
                            title: "Monitor Rescue: Screen Swap",
                            description: "The cables are fine, but the monitor itself might be the issue.",
                            icon: 'monitor',
                            instruction: "Connect the Raspberry Pi hardware to a completely different monitor that you know is working.",
                            options: [
                                { label: "It works on the new screen!", next: 'os_confirmation_monitor', color: 'bg-[#206a5d]' },
                                { label: "Still nothing on any screen.", next: 'monitor_fail_result', color: 'bg-orange-600' },
                                { label: "Screen is on, but Pi won't boot.", next: 'sd_reformat', color: 'bg-blue-700' }
                            ]
                        },
                        monitor_fail_result: {
                            type: 'result',
                            status: 'warning',
                            title: "Diagnosis: Faulty Monitor or Cable",
                            description: "The original HDMI cable or the monitor itself appears to be broken.",
                            recommendation: "Replace the HDMI cable first. If the problem persists, the monitor needs to be replaced. Contact the PSC program lead to arrange a replacement.",
                            icon: 'monitor'
                        },
                        sd_reformat: {
                            title: "The Brain Check: Phase 1 (Software)",
                            description: "The hardware is on, but the software on the card might be corrupted.",
                            icon: 'laptop',
                            instruction: "Follow these steps exactly on a separate computer:",
                            detailedSteps: [
                                { text: "Open 'Raspberry Pi Imager'. If you don't have it, install it from:", link: "https://www.raspberrypi.com/software/" },
                                { text: "Select Device: Raspberry Pi 5", bold: true },
                                { text: "Select OS: Raspberry Pi OS (64-bit)", bold: true },
                                { text: "Customization such as hostname, localization, and account registration are optional." }
                            ],
                            image: "https://www.raspberrypi.com/documentation/computers/images/imager-v1.8.png",
                            options: [
                                { label: "Reformat complete! Desktop is visible.", next: 'sd_corrupted_result', color: 'bg-[#206a5d]' },
                                { label: "I reformatted, but it still won't boot.", next: 'sd_swap', color: 'bg-slate-700' }
                            ]
                        },
                        sd_corrupted_result: {
                            type: 'result',
                            status: 'success',
                            title: "Diagnosis: microSD Card Corrupted",
                            description: "Your Raspberry Pi hardware is fine, but the data on the microSD card was corrupted.",
                            recommendation: "Reformatting fixed the software issue. To prevent this, always 'Shut Down' from the Pi menu before unplugging the power.",
                            icon: 'file-warning'
                        },
                        sd_swap: {
                            title: "The Brain Check: Phase 2 (Hardware)",
                            description: "If reformatting didn't help, the physical card might be corrupted or faulty.",
                            icon: 'hard-drive',
                            instruction: "Swap to a different microSD card that you know is working (borrow one from a successful setup).",
                            options: [
                                { label: "That fixed it! Desktop is visible.", next: 'sd_faulty_result', color: 'bg-[#206a5d]' },
                                { label: "Even a new card fails.", next: 'sd_pi_fail_result', color: 'bg-red-600' }
                            ]
                        },
                        sd_faulty_result: {
                            type: 'result',
                            status: 'success',
                            title: "Diagnosis: microSD Card Hardware Failure",
                            description: "Your previous microSD card is likely physically faulty or permanently corrupted.",
                            recommendation: "Since a different card worked, your old card needs to be replaced. Please label the old card as 'Faulty' and dispose of it properly.",
                            icon: 'hard-drive'
                        },
                        sd_pi_fail_result: {
                            type: 'result',
                            status: 'error',
                            title: "Diagnosis: Hardware or Slot Failure",
                            description: "We've checked the monitor, the cables, and multiple microSD cards.",
                            recommendation: "Since even a good microSD card failed, the Raspberry Pi hardware itself likely has a fault and needs to be replaced. Please contact PSC staff for next steps.",
                            icon: 'alert-circle'
                        },
                        faulty_cable_result: {
                            type: 'result',
                            status: 'success',
                            title: "Success: Faulty Power Cable",
                            description: "Your Raspberry Pi is working now, but only because we swapped the power cable.",
                            recommendation: "Please label and discard your original power cable/supply as it is faulty and unsafe to use. Please replace it with a working cable instead.",
                            icon: 'zap'
                        },
                        faulty_hdmi_result: {
                            type: 'result',
                            status: 'success',
                            title: "Success: Faulty HDMI Connection",
                            description: "The display is working now, indicating that the previous HDMI cable or connection was the issue.",
                            recommendation: "If you had to swap the HDMI cable to get an image, please discard the original faulty cable. If you only had to re-seat it, ensure the connections are always firm.",
                            icon: 'monitor'
                        },
                        faulty_monitor_result: {
                            type: 'result',
                            status: 'success',
                            title: "Success: Faulty Monitor Identified",
                            description: "The system is working now with a different monitor, confirming the original screen hardware is faulty.",
                            recommendation: "Please label the original monitor as 'Faulty' and contact your PSC lead for a replacement. Use the working monitor for now.",
                            icon: 'monitor'
                        },
                        it_works: {
                            type: 'result',
                            status: 'success',
                            title: "System Fully Operational",
                            description: "Your Raspberry Pi hardware is up and running. Happy computing!",
                            recommendation: "Remember to always shut down properly from the menu before unplugging or switching off the plug.",
                            icon: 'check-circle-2'
                        }
                    }
                },
                ms: {
                    header: "Pi Helper",
                    subHeader: "Panduan Penyelesaian Masalah",
                    startOver: "Set Semula",
                    mission: "Arahan:",
                    recommendation: "Diagnosis & Langkah Seterusnya:",
                    footer: "Dibina untuk program MakerLab di Sekolah oleh Penang Science Cluster",
                    aiLabel: "Optional / Pilihan",
                    aiSubLabel: "Pilihan: Ceritakan apa yang berlaku",
                    aiPlaceholder: "contoh: 'Lampu kuning berkelip' atau 'Skrin hitam'...",
                    aiButton: "Analisis Masalah",
                    aiError: "Maaf, saya tidak dapat memproses masalah tersebut. Mari bermula dari awal.",
                    steps: {
                        start: {
                            title: "Adakah Raspberry Pi anda dapat dihidupkan?",
                            description: "Mari kita periksa sama ada Raspberry Pi mendapat sebarang bekalan kuasa.",
                            icon: 'power',
                            options: [
                                { label: "Ya, ia hidup!", next: 'led_check', color: 'bg-[#206a5d]' },
                                { label: "Tidak, ia senyap.", next: 'plug_in', color: 'bg-slate-700' }
                            ]
                        },
                        plug_in: {
                            title: "Memeriksa Soket/Suis",
                            description: "Pastikan perkakasan disambungkan secara fizikal ke punca kuasa.",
                            icon: 'zap',
                            instruction: "Sahkan kabel kuasa dipasang dengan kemas pada Raspberry Pi dan soket dinding.",
                            image: "https://images.unsplash.com/photo-1591488320449-011701bb6704?auto=format&fit=crop&q=80&w=1000", 
                            options: [
                                { label: "Baik, saya sudah sambung!", next: 'led_check', color: 'bg-[#206a5d]' }
                            ]
                        },
                        led_check: {
                            title: "Memeriksa Lampu Butang 'Power'",
                            description: "Lihat pada perkakasan Raspberry Pi. Terdapat lampu pada butang 'power' di sisi Raspberry Pi.",
                            icon: 'palette',
                            instruction: "Apakah warna lampu pada butang 'power' Raspberry Pi?",
                            image: "https://www.raspberrypi.com/documentation/computers/images/Pi5-annotated-top.png",
                            options: [
                                { label: "Kuning (Berkelip/Tetap)", next: 'use_check', color: 'bg-yellow-600' },
                                { label: "Tiada lampu langsung.", next: 'swap_psu', color: 'bg-slate-600' }
                            ]
                        },
                        swap_psu: {
                            title: "Tukar Bekalan Kuasa",
                            description: "Memandangkan tiada lampu, bekalan kuasa atau kabel semasa mungkin rosak.",
                            icon: 'refresh-cw',
                            instruction: "Cuba tukar bekalan kuasa/kabel Raspberry Pi dengan yang lain.",
                            options: [
                                { label: "Saya nampak lampu sekarang!", next: 'use_check_swapped', color: 'bg-[#206a5d]' },
                                { label: "Masih tiada lampu langsung.", next: 'pi_faulty_result', color: 'bg-red-600' }
                            ]
                        },
                        pi_faulty_result: {
                            type: 'result',
                            status: 'error',
                            title: "Diagnosis: Kerosakan Perkakasan",
                            description: "Walaupun bekalan kuasa dan sambungan telah diperiksa, papan Raspberry Pi tetap tidak dapat dihidupkan dengan betul.",
                            recommendation: "Papan Raspberry Pi itu sendiri telah rosak. Sila labelkan unit ini sebagai 'Rosak' (Faulty) dan hubungi staf PSC untuk penggantian.",
                            icon: 'alert-circle'
                        },
                        use_check: {
                            title: "Pemeriksaan Kebolehgunaan",
                            description: "Lampu berwarna kuning, petanda yang bagus untuk perkakasan!",
                            icon: 'cpu',
                            instruction: "Adakah anda dapat menggunakan komputer (nampak desktop, gerakkan tetikus)?",
                            options: [
                                { label: "Ya, saya boleh gunakannya!", next: 'os_confirmation', color: 'bg-[#206a5d]' },
                                { label: "Tidak, saya masih tidak boleh menggunakannya.", next: 'monitor_check', color: 'bg-slate-700' }
                            ]
                        },
                        use_check_swapped: {
                            title: "Pemeriksaan Kebolehgunaan",
                            description: "Perkakasan memberi respon kepada punca kuasa yang baru.",
                            icon: 'cpu',
                            instruction: "Adakah anda dapat menggunakan komputer sekarang?",
                            options: [
                                { label: "Ya, ia sudah berfungsi!", next: 'os_confirmation_swapped', color: 'bg-[#206a5d]' },
                                { label: "Tidak, masih tiada imej.", next: 'monitor_check', color: 'bg-slate-700' }
                            ]
                        },
                        os_confirmation: {
                            title: "Pengesahan Sistem",
                            description: "Sahkan bahawa sistem operasi telah dimuatkan sepenuhnya.",
                            icon: 'layout',
                            instruction: "Adakah anda dapat melihat desktop Raspberry Pi OS sepenuhnya (menu, kertas dinding, dan ikon)?",
                            options: [
                                { label: "Ya, semuanya berfungsi!", next: 'it_works', color: 'bg-[#206a5d]' },
                                { label: "Tidak, saya tidak nampak OS desktop.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_swapped: {
                            title: "Pengesahan Terakhir",
                            description: "Perkakasan memberi respon kepada punca kuasa yang baru.",
                            icon: 'layout',
                            instruction: "Adakah desktop Raspberry Pi OS kelihatan sepenuhnya?",
                            options: [
                                { label: "Ya, semuanya berfungsi!", next: 'faulty_cable_result', color: 'bg-[#206a5d]' },
                                { label: "Tidak, saya tidak nampak OS desktop.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_hdmi: {
                            title: "Pengesahan Visual",
                            description: "Menyemak sama ada sambungan monitor kini stabil.",
                            icon: 'layout',
                            instruction: "Adakah desktop Raspberry Pi OS kelihatan sepenuhnya pada skrin sekarang?",
                            options: [
                                { label: "Ya, saya nampak OS desktop!", next: 'faulty_hdmi_result', color: 'bg-[#206a5d]' },
                                { label: "Tidak, saya tidak nampak OS desktop.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        os_confirmation_monitor: {
                            title: "Pengesahan Visual",
                            description: "Raspberry Pi memaparkan imej pada monitor baru.",
                            icon: 'layout',
                            instruction: "Adakah desktop Raspberry Pi OS kelihatan sepenuhnya pada skrin baru?",
                            options: [
                                { label: "Ya, ia berfungsi!", next: 'faulty_monitor_result', color: 'bg-[#206a5d]' },
                                { label: "Tidak, ralat perisian.", next: 'sd_reformat', color: 'bg-orange-600' }
                            ]
                        },
                        monitor_check: {
                            title: "Adakah Skrin Menunjukkan Apa-apa?",
                            description: "Perkakasan Raspberry Pi hidup, tetapi monitor bermasalah.",
                            icon: 'monitor',
                            instruction: "Lihat pada skrin monitor anda. Adakah anda melihat sebarang teks, warna, atau desktop?",
                            options: [
                                { label: "Ya, saya nampak sesuatu (tapi tidak berfungsi dengan betul).", next: 'sd_reformat', color: 'bg-orange-500' },
                                { label: "Tidak, skrin hitam sepenuhnya atau tiada signal.", next: 'monitor_hdmi_check', color: 'bg-slate-700' }
                            ]
                        },
                        monitor_hdmi_check: {
                            title: "Penyelamatan Monitor: Semak HDMI",
                            description: "Mari periksa sambungan antara Pi and skrin monitor.",
                            icon: 'settings',
                            instruction: "Ikuti langkah ini untuk memeriksa sambungan HDMI monitor:",
                            detailedSteps: [
                                { text: "Pastikan monitor dihidupkan." },
                                { text: "Cabut dan pasang semula kabel HDMI dengan kemas." },
                                { text: "Gantikan dengan kabel HDMI yang berlainan jika masih tidak berjaya." }
                            ],
                            image: "https://images.unsplash.com/photo-1629739682536-3990664972f7?auto=format&fit=crop&q=80&w=1000",
                            options: [
                                { label: "Ia berfungsi sekarang!", next: 'os_confirmation_hdmi', color: 'bg-[#206a5d]' },
                                { label: "Masih nampak skrin hitam.", next: 'monitor_swap_check', color: 'bg-slate-700' }
                            ]
                        },
                        monitor_swap_check: {
                            title: "Penyelamatan Monitor: Tukar Skrin",
                            description: "Kabel berfungsi, tetapi monitor itu sendiri mungkin bermasalah.",
                            icon: 'monitor',
                            instruction: "Sambungkan perkakasan Raspberry Pi ke monitor lain yang anda yakin boleh berfungsi.",
                            options: [
                                { label: "Ia berfungsi pada skrin baru!", next: 'os_confirmation_monitor', color: 'bg-[#206a5d]' },
                                { label: "Masih tiada apa-apa pada mana-mana skrin.", next: 'monitor_fail_result', color: 'bg-orange-500' },
                                { label: "Skrin hidup, tetapi tidak dapat melihat OS Raspberry Pi.", next: 'sd_reformat', color: 'bg-blue-700' }
                            ]
                        },
                        monitor_fail_result: {
                            type: 'result',
                            status: 'warning',
                            title: "Diagnosis: Monitor atau Kabel Rosak",
                            description: "Kabel HDMI asal atau monitor itu sendiri nampaknya telah rosak.",
                            recommendation: "Gantikan kabel HDMI dahulu. Jika masalah berterusan, monitor perlu diganti. Hubungi ketua program PSC untuk urusan penggantian.",
                            icon: 'monitor'
                        },
                        sd_reformat: {
                            title: "Pemeriksaan 'Otak': Fasa 1 (Perisian)",
                            description: "Perkakasan hidup, tetapi perisian pada kad mungkin rosak.",
                            icon: 'laptop',
                            instruction: "Ikuti langkah-langkah ini dengan menggunakan komputer lain:",
                            detailedSteps: [
                                { text: "Buka 'Raspberry Pi Imager'.", link: "https://www.raspberrypi.com/software/" },
                                { text: "Pilih Peranti (Device): Raspberry Pi 5", bold: true },
                                { text: "Pilih OS: Raspberry Pi OS (64-bit)", bold: true },
                                { text: "Tetapan lain (hostname, localisation, dll.) adalah pilihan." }
                            ],
                            image: "https://www.raspberrypi.com/documentation/computers/images/imager-v1.8.png",
                            options: [
                                { label: "Selesai! OS Desktop dapat dilihat.", next: 'sd_corrupted_result', color: 'bg-[#206a5d]' },
                                { label: "Dah format tapi masih tak masuk OS.", next: 'sd_swap', color: 'bg-slate-700' }
                            ]
                        },
                        sd_corrupted_result: {
                            type: 'result',
                            status: 'success',
                            title: "Diagnosis: Kad microSD 'Corrupt'",
                            description: "Perkakasan Raspberry Pi anda dalam keadaan baik, tetapi data pada kad microSD telah 'corrupt'.",
                            recommendation: "Proses format semula telah membaiki isu perisian. Sentiasa gunakan 'Shut Down' dari menu Pi sebelum menutup bekalan kuasa.",
                            icon: 'file-warning'
                        },
                        sd_swap: {
                            title: "Pemeriksaan 'Otak': Fasa 2 (Perkakasan)",
                            description: "Jika format tidak membantu, kad fizikal mungkin rosak.",
                            icon: 'hard-drive',
                            instruction: "Tukar ke kad microSD lain yang anda yakin boleh berfungsi (pinjam dari setup yang berjaya).",
                            options: [
                                { label: "Berjaya! OS Desktop dapat berfungsi.", next: 'sd_faulty_result', color: 'bg-[#206a5d]' },
                                { label: "Kad baru pun gagal", next: 'sd_pi_fail_result', color: 'bg-red-600' }
                            ]
                        },
                        sd_faulty_result: {
                            type: 'result',
                            status: 'success',
                            title: "Diagnosis: Kerosakan Kad microSD",
                            description: "Kad microSD anda sebelum ini berkemungkinan besar mengalami kerosakan fizikal atau korupsi kekal.",
                            recommendation: "Memandangkan kad baru berfungsi, kad lama anda perlu diganti. Sila labelkan kad lama sebagai 'Rosak' dan gantikan dengan kad baru.",
                            icon: 'hard-drive'
                        },
                        sd_pi_fail_result: {
                            type: 'result',
                            status: 'error',
                            title: "Diagnosis: Kegagalan Perkakasan",
                            description: "Kita telah memeriksa monitor, kabel, dan berbilang kad microSD.",
                            recommendation: "Memandangkan kad microSD yang baru juga gagal, perkakasan Raspberry Pi itu sendiri mungkin mempunyai kerosakan dan perlu diganti.",
                            icon: 'alert-circle'
                        },
                        faulty_cable_result: {
                            type: 'result',
                            status: 'success',
                            title: "Berjaya: Kabel Kuasa Rosak",
                            description: "Raspberry Pi anda berfungsi sekarang, tetapi hanya kerana kita telah menukar kabel kuasa.",
                            recommendation: "Sila label dan buangkan kabel/bekalan kuasa asal anda kerana ia telah rosak dan tidak selamat digunakan. Gantikan dengan kabel yang berfungsi.",
                            icon: 'zap'
                        },
                        faulty_hdmi_result: {
                            type: 'result',
                            status: 'success',
                            title: "Berjaya: Kerosakan Sambungan HDMI",
                            description: "Paparan kini berfungsi, menunjukkan bahawa kabel atau sambungan HDMI sebelum ini adalah punca masalah.",
                            recommendation: "Jika anda terpaksa menukar kabel HDMI, sila buang kabel yang rosak tersebut. Jika anda hanya perlu memasangnya semula, pastikan sambungan sentiasa kemas.",
                            icon: 'monitor'
                        },
                        faulty_monitor_result: {
                            type: 'result',
                            status: 'success',
                            title: "Berjaya: Monitor Rosak Dikenalpasti",
                            description: "Sistem berfungsi dengan monitor lain, mengesahkan monitor asal telah rosak.",
                            recommendation: "Sila labelkan monitor asal sebagai 'Rosak' dan hubungi ketua program PSC untuk penggantian. Gunakan monitor yang berfungsi buat masa ini.",
                            icon: 'monitor'
                        },
                        it_works: {
                            type: 'result',
                            status: 'success',
                            title: "Sistem Berfungsi Sepenuhnya",
                            description: "Perkakasan Raspberry Pi anda telah sedia. Selamat menggunakannya!",
                            recommendation: "Ingat untuk sentiasa tutup (Shut Down) dengan betul dari menu sebelum mematikan suis.",
                            icon: 'check-circle-2'
                        }
                    }
                }
            };

            const analyzeProblem = async () => {
                if (!userInput.trim()) return;
                setIsAnalyzing(true);
                setErrorMessage(null);
                const systemPrompt = `Analyze technical issue and return ONLY the key: 'plug_in', 'led_check', 'monitor_check', 'sd_reformat', or 'start'.`;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: userInput }] }], systemInstruction: { parts: [{ text: systemPrompt }] } })
                    });
                    const data = await response.json();
                    const resultKey = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim().toLowerCase();
                    if (content.en.steps[resultKey]) {
                        setHistory([...history, step]);
                        setStep(resultKey);
                    } else { setStep('start'); }
                } catch (err) { setErrorMessage(content[lang].aiError); } finally { setIsAnalyzing(false); }
            };

            useEffect(() => {
                lucide.createIcons();
            }, [step, lang]);

            const current = content[lang].steps[step];
            const t = content[lang];

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col font-sans transition-all duration-500 pb-16">
                    <header className="bg-white border-b px-8 py-5 flex items-center justify-between shadow-sm sticky top-0 z-50">
                        <div className="flex items-center gap-4">
                            <div className="bg-psc p-2.5 rounded-xl shadow-lg shadow-emerald-900/20 text-white">
                                <i data-lucide="cpu" className="w-6 h-6"></i>
                            </div>
                            <div>
                                <h1 className="font-serif text-2xl text-slate-900 leading-none">{t.header}</h1>
                                <span className="text-[10px] uppercase tracking-widest text-slate-400 font-bold">{t.subHeader}</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-6">
                            <button onClick={() => setLang(lang === 'en' ? 'ms' : 'en')} className="flex items-center gap-2 px-4 py-2 rounded-full border border-slate-200 text-xs font-bold text-slate-600 hover:border-psc hover:text-psc transition-all">
                                <i data-lucide="languages" className="w-4 h-4"></i> {lang === 'en' ? 'Bahasa Melayu' : 'English'}
                            </button>
                            <button onClick={() => { setStep('start'); setHistory([]); }} className="flex items-center gap-2 text-xs font-bold text-slate-400 hover:text-red-600 transition-colors group">
                                <i data-lucide="rotate-ccw" className="w-4 h-4 group-hover:rotate-[-45deg] transition-transform"></i> {t.startOver}
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 flex flex-col items-center justify-center p-4 md:p-8">
                        <div className="flex items-center justify-center gap-12 mb-12 opacity-80">
                           <div className="h-14 w-40 flex items-center justify-center border border-dashed border-slate-300 rounded-lg text-[10px] font-bold text-slate-300 uppercase tracking-tighter text-center px-4">PSC Logo</div>
                           <div className="h-12 w-px bg-slate-200" />
                           <div className="h-14 w-40 flex items-center justify-center border border-dashed border-slate-300 rounded-lg text-[10px] font-bold text-slate-300 uppercase tracking-tighter text-center px-4">MakerLab Logo</div>
                        </div>

                        <div className="max-w-2xl w-full bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200 overflow-hidden border border-slate-100 animate-slide-up">
                            {!current.type && (
                                <div className="h-1.5 w-full bg-slate-100">
                                    <div className="h-full bg-psc transition-all duration-700 ease-out" style={{ width: `${Math.min((history.length + 1) * 12, 100)}%` }} />
                                </div>
                            )}

                            <div className="p-8 md:p-12">
                                <div className="flex flex-col items-center text-center mb-8">
                                    <div className="mb-6 transform hover:scale-110 transition-transform duration-300 p-6 bg-emerald-50 rounded-3xl text-psc">
                                        <i data-lucide={current.icon} className="w-12 h-12"></i>
                                    </div>
                                    <h2 className="text-3xl md:text-5xl font-serif text-slate-900 mb-6 leading-tight">{current.title}</h2>
                                    <p className="text-slate-500 text-lg md:text-xl max-w-2xl leading-relaxed">{current.description}</p>
                                </div>

                                {step === 'start' && (
                                    <div className="mb-8 p-6 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 group focus-within:border-blue-300 transition-all relative shadow-inner">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="text-[10px] font-black bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full uppercase tracking-widest">Optional / Pilihan</span>
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-tight">{t.aiLabel}</label>
                                        </div>
                                        <textarea value={userInput} onChange={(e) => setUserInput(e.target.value)} placeholder={t.aiPlaceholder} className="w-full bg-transparent border-none focus:ring-0 text-slate-700 placeholder-slate-400 resize-none h-20 mb-3 font-sans" />
                                        <div className="flex items-center justify-between pt-2 border-t border-slate-100">
                                            <div className="flex items-center gap-1.5 text-slate-400">
                                                <i data-lucide="info" className="w-3.5 h-3.5"></i>
                                                <span className="text-[10px] font-medium leading-none">{t.aiInfo}</span>
                                            </div>
                                            <button onClick={analyzeProblem} disabled={!userInput.trim() || isAnalyzing} className="flex items-center gap-2 px-4 py-2 bg-slate-900 text-white rounded-xl text-sm font-bold hover:bg-blue-600 disabled:opacity-30 disabled:hover:bg-slate-900 transition-all shadow-md active:scale-95">
                                                {isAnalyzing ? <i data-lucide="loader-2" className="animate-spin w-4 h-4"></i> : <i data-lucide="sparkles" className="w-4 h-4 text-yellow-400"></i>}
                                                {t.aiButton}
                                            </button>
                                        </div>
                                        {errorMessage && <p className="mt-2 text-xs text-red-500 font-medium">{errorMessage}</p>}
                                    </div>
                                )}

                                {current.instruction && (
                                    <div className="bg-[#206a5d]/5 border border-[#206a5d]/10 rounded-[2rem] p-8 mb-10 overflow-hidden shadow-inner">
                                        <div className="flex gap-4 mb-4">
                                            <div className="bg-psc p-3 h-fit rounded-2xl shadow-lg text-white">
                                                <i data-lucide="lightbulb" className="w-5 h-5"></i>
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-serif text-xl text-psc mb-2">{t.mission}</h4>
                                                <p className="text-slate-600 text-lg leading-relaxed">{current.instruction}</p>
                                            </div>
                                        </div>
                                        {current.detailedSteps && (
                                            <ul className="space-y-3 pl-10 border-l-2 border-psc/20 ml-4 py-1 mb-4">
                                                {current.detailedSteps.map((s, i) => (
                                                    <li key={i} className="text-slate-600 text-sm flex items-start gap-2">
                                                        <div className="font-bold text-psc mt-0.5 w-4 shrink-0">{i + 1}.</div>
                                                        <div className="flex-1">
                                                            <span className={s.bold ? "font-bold text-slate-900" : ""}>{s.text || s[lang]}</span>
                                                            {s.link && <a href={s.link} target="_blank" className="inline-flex items-center gap-1 ml-2 text-psc font-bold hover:underline">Download <i data-lucide="external-link" className="w-3 h-3"></i></a>}
                                                        </div>
                                                    </li>
                                                ))}
                                            </ul>
                                        )}
                                        {current.image && (
                                            <div className="mt-4 rounded-xl overflow-hidden border-4 border-white shadow-xl bg-white">
                                                <img src={current.image} className="w-full h-auto object-cover max-h-64" onError={(e) => { e.target.parentElement.style.display = 'none'; }} />
                                            </div>
                                        )}
                                    </div>
                                )}

                                {current.type === 'result' ? (
                                    <div className="space-y-6">
                                        <div className="bg-slate-50 rounded-2xl p-6 border border-slate-100 shadow-inner">
                                            <h4 className="font-serif text-2xl text-slate-900 mb-4 flex items-center gap-3">
                                                <i data-lucide="book-open" className="w-6 h-6 text-psc"></i> {t.recommendation}
                                            </h4>
                                            <p className="text-slate-500 leading-relaxed text-lg">{current.recommendation}</p>
                                        </div>
                                        <button onClick={() => { setStep('start'); setHistory([]); }} className="w-full py-6 rounded-2xl bg-psc text-white font-bold text-lg hover:brightness-110 transition-all shadow-lg active:scale-95 flex items-center justify-center gap-2 group">
                                            <i data-lucide="rotate-ccw" className="w-5 h-5 group-hover:rotate-[-45deg] transition-transform"></i> {t.startOver}
                                        </button>
                                    </div>
                                ) : (
                                    <div className="flex flex-col gap-3">
                                        {current.options.map((option, idx) => (
                                            <button key={idx} onClick={() => { setHistory([...history, step]); setStep(option.next); }} className={`${option.color} text-white p-6 rounded-2xl font-bold text-lg shadow-xl hover:brightness-110 hover:-translate-y-1 transition-all flex items-center justify-between group`}>
                                                <span>{option.label}</span>
                                                <div className="bg-white/20 p-2 rounded-xl">
                                                    <i data-lucide="chevron-right" className="w-5 h-5 group-hover:translate-x-1 transition-all"></i>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>
                    <footer className="mt-auto py-8 text-center"><p className="text-[11px] font-bold text-slate-300 uppercase tracking-[0.3em]">{t.footer}</p></footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
